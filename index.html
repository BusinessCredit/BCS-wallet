<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1,maximum-scale=1, minimum-scale=1">
    <link rel="stylesheet" href="css/mui.min.css">
    <link rel="stylesheet" href="css/unified.css">
    <link rel="stylesheet" href="css/index.css">
    <script src="js/jquery-3.3.1.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/rem.js"></script>
    <script src="js/mui.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/vue.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/public.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/util.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/update.js" type="text/javascript" charset="utf-8"></script>
    <script src="light-wallet/web3.js" type="text/javascript" charset="utf-8"></script>
    <title>钱包</title>
    <script type="text/javascript">
		mui.plusReady(function() {
			//底部菜单
			BottomMenu();
			//检测更新
			update_check();
			//状态
			var walletInfo = getItem("walletInfo");
			if(!getItem("walletInfo")) {
				var all = plus.webview.all();
				for(var i = 0; i < all.length; i++) {
					all[i].hide();
				};
				show('init');
			}else{
				vm.initData();
				plus.navigator.closeSplashscreen();
			}
		});
	</script>
</head>
<body>
<div class="indexWrapper footerWrapper" id="app">
    <div class="otherMask mask" @tap="isOtherList=false" v-if="isOtherList"></div>
    <header class="flex-box header otherHeader">
    	<div class="seize"></div>
        <div class="box-1 text">钱 包</div>
        <img @tap="show('wallet_detail')" :src="headImg" class="mui-action-2">
    </header>
    <div class="unContent indexContent">
        <div class="l-header">
            <div class="desc-1" @tap="show('address_ewm')">
                <p>{{walletName}}</p>
                <h3>{{walletAddress}}<img src="img/l-ewm-x-ico1.png"></h3>
            </div>
            <div class="desc-2">
                <p>总资产(BCS)</p>
                <h2 class="flex-box"><span>{{account}}</span> <b>≈ ¥{{account_cny}}</b></h2>
            </div>
        </div>
        <div class="content">
            <h1 class="title flex-box"><span>我的资产</span></h1>
            <ul>
                <li class="bcs-b1 flex-box" @tap="show('trade')">
                    <div class="left flex-box">
                        <img src="img/logo-ico-1.png">BCS
                    </div>
                    <div class="right">
                        <h2>{{account}}</h2>
                        <p>≈ ¥{{account_cny}}</p>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</div>
</body>

<script type="text/javascript">
	var immersed = getImmersedHeight();
	$(".header").css('padding-top', (immersed + 5) + 'px');
    var vm = new Vue({
        el: '#app',
        data: {
        	walletName:'',
        	headImg:'',
        	walletAddress:'',
        	walletAddressReal:'',
        	account:0,
        	bcs2cny:6.2,
        	isOtherList:false
        },
        computed:{
        	account_cny:function(){
        		return this.account*this.bcs2cny;
        	}
        },
       	methods:{
       		initData:function(){
       			var walletinfo = getItem('walletInfo');
	        	var userinfo = getItem('userInfo');
	        	this.walletName = userinfo.walletName;
	        	this.headImg = userinfo.headImg;
	        	this.walletAddressReal = walletinfo.walletAddress;
	        	this.walletAddress = shortAddress(walletinfo.walletAddress);
	        	this.getBalance(walletinfo.walletAddress);
       		},
       		getBalance:function(){
       			plus.nativeUI.showWaiting();
       			var web3 = initWeb3();
       			var _self = this;
       			web3.eth.getBalance(_self.walletAddressReal,function(err,res){
       				plus.nativeUI.closeWaiting();
       				if(err){
       					plus.nativeUI.alert('网络异常');
       				}else{
       					_self.account = res;
       				}
       			});
       		}
       	}
    })
</script>
</html>