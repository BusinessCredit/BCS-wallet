<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1,maximum-scale=1, minimum-scale=1">
    <link rel="stylesheet" href="css/mui.min.css">
	<link rel="stylesheet" href="css/unified.css">
	<link rel="stylesheet" href="css/index.css">
	<link rel="stylesheet" href="css/name.css">
	<script src="js/jquery-3.3.1.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/jquery-3.3.1.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/rem.js"></script>
	<script src="js/mui.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/vue.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/public.js" type="text/javascript" charset="utf-8"></script>
	<script src="mescroll/mescroll.min.js" type="text/javascript"></script>
	<link rel="stylesheet" href="mescroll/mescroll.min.css">
    <title>消息中心</title>
</head>
<body>
<div class="newsWrapper" id="app">
    <div class="unContent">
        <div class="content mescroll" id="mescroll" style="height: 12rem;">
            <ul id='warpId'>
                <li v-for='item in list'>
                    <div class="infor flex-box">
                        <span class="box-1 media_title">{{item.title}}</span>
                        <b>{{item.date}}</b>
                    </div>
                    <p>{{item.desc}}</p>
                </li>
            </ul>
        </div>
    </div>
</div>
</body>
<script type="text/javascript">
	var immersed = getImmersedHeight();
	$(".header").css('padding-top', (immersed + 5) + 'px');
    var vm = new Vue({
        el: '#app',
        data: {
            mescroll: [],
            list: []
        },
        methods: {
            initData: function(page) {
                var self = this;
                $.ajax({
                    type: "get",
                    url: NewsList,
                    data: {
                        page: page.num
                    },
                    dataType: "json",
                    success: function(data){
                        if(data.status) {
                            var result = data.result;
                            if(page.num == 1) {
                                self.list = result.list;
                            } else {
                                self.list = self.list.concat(result.list);
                            }
                            self.mescroll.endByPage(result.list.length, result.totalPage);
                        } else {
                           self.list = [];
                        }
                    },
                    error: function(data) {
                        console.log(JSON.stringify(data));
                    }
                });
            },
            initMescroll: function(mescrollId, warpId) {
                var self = this;
                var mescroll = new MeScroll(mescrollId, {
                    up: {
                        callback: function(page) {
                            self.initData(page);
                        },
                        page: {
                            num: 0,
                            size: 10,
                            time: null
                        },
                        isBounce: false,
                        noMoreSize: 20,
                        empty: {
                            warpId: warpId,
                            icon: "img/icon/none.png",
                            tip: "暂无消息~",
                        },
                        htmlNodata: '<p class="upwarp-nodata">没有更多了哦 ^v^</p>'
                    }
                });
                return mescroll;
            }
        },
        mounted: function() {
            this.mescroll = this.initMescroll('mescroll', 'warpId');
        }
    })
</script>
</html>